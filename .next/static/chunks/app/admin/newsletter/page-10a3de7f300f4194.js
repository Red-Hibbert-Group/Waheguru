(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{1617:function(e,t,s){Promise.resolve().then(s.bind(s,3165))},3165:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return n}});var a=s(7437),i=s(2265),r=s(9866);function n(){let[e,t]=(0,i.useState)([]),[s,n]=(0,i.useState)(!0),[c,l]=(0,i.useState)(""),[o,d]=(0,i.useState)(""),[u,m]=(0,i.useState)({exists:!1,columns:[]});async function x(){try{let{data:e,error:t}=await r.OQ.from("newsletter_subscriptions").select("id").limit(1),s=!t||"42P01"!==t.code,a=[];if(s){let{data:e}=await r.OQ.rpc("get_table_columns",{table_name:"newsletter_subscriptions"});e&&(a=e)}m({exists:s,columns:a})}catch(e){console.error("Error checking database:",e)}}async function h(){n(!0);try{let{data:e,error:s}=await r.OQ.from("newsletter_subscriptions").select("*").order("subscription_date",{ascending:!1});if(s)throw s;t(e||[])}catch(e){console.error("Error loading subscriptions:",e),l("Failed to load subscriptions")}finally{n(!1)}}async function b(){try{let e=await fetch("/api/init-db"),t=await e.json();alert("Database initialization: ".concat(t.message)),x(),h()}catch(e){console.error("Error initializing database:",e),alert("Failed to initialize database")}}async function p(){if(!o){alert("Please enter a test email");return}try{let e=await fetch("/api/newsletter/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})}),t=await e.json();alert("Subscription test: ".concat(t.message)),h()}catch(e){console.error("Error testing subscription:",e),alert("Failed to test subscription")}}return(0,i.useEffect)(()=>{x(),h()},[]),(0,a.jsxs)("div",{className:"p-8 max-w-6xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Newsletter Admin"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Database Status"}),(0,a.jsxs)("p",{className:"mb-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Table exists:"})," ",(0,a.jsx)("span",{className:u.exists?"text-green-600":"text-red-600",children:u.exists?"Yes":"No"})]}),u.columns.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium mb-2",children:"Columns:"}),(0,a.jsx)("ul",{className:"text-sm",children:u.columns.map(e=>(0,a.jsxs)("li",{className:"mb-1",children:[e.column_name,": ",e.data_type]},e.column_name))})]}),(0,a.jsx)("button",{onClick:b,className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Initialize Database"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Test Subscription"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Test Email"}),(0,a.jsx)("input",{type:"email",value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border rounded",placeholder:"test@example.com"})]}),(0,a.jsx)("button",{onClick:p,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Test Subscribe"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold p-6 border-b",children:"Newsletter Subscriptions"}),s?(0,a.jsx)("div",{className:"p-6 text-center",children:"Loading..."}):c?(0,a.jsx)("div",{className:"p-6 text-center text-red-600",children:c}):0===e.length?(0,a.jsx)("div",{className:"p-6 text-center text-gray-500",children:"No subscriptions found"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Source"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.email}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:new Date(e.subscription_date).toLocaleString()}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:e.source})]},e.id))})]})})]})]})}},9866:function(e,t,s){"use strict";s.d(t,{OQ:function(){return i},Wg:function(){return n},zV:function(){return r}});var a=s(4756);let i=(0,a.eI)("https://obwokyhpvdqewaatrnma.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9id29reWhwdmRxZXdhYXRybm1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQzNjMzMjgsImV4cCI6MjA1OTkzOTMyOH0.DK8PEGmTyC32HWislTj1oDmx4y6JG0gK43HX2IR8xck");async function r(e,t,s){try{let{error:a}=await i.from("contact_submissions").insert([{name:e,email:t,message:s}]);if(a)throw a;return{success:!0,message:"Thank you for your message! We will get back to you soon."}}catch(e){return console.error("Error submitting contact form:",e),{success:!1,message:"Something went wrong. Please try again later."}}}async function n(e,t){try{let{data:t,error:s}=await i.from("newsletter_subscriptions").select("id").eq("email",e).eq("status","active").single();if(s||!t)return{success:!1,message:"Email not found in our active subscription list."};let{error:a}=await i.from("newsletter_subscriptions").update({status:"inactive",unsubscribed_at:new Date().toISOString()}).eq("email",e);if(a)throw a;return{success:!0,message:"Successfully unsubscribed from our newsletter."}}catch(e){return console.error("Newsletter unsubscribe error:",e),{success:!1,message:"Failed to unsubscribe. Please try again later."}}}(async function(){try{console.log("Checking database tables...");let{data:e,error:t}=await i.from("newsletter_subscriptions").select("id").limit(1);t?(console.error("Error checking newsletter_subscriptions table:",t),"42P01"===t.code&&(console.log("Creating newsletter_subscriptions table..."),console.error("Table missing! Please create the newsletter_subscriptions table manually."))):console.log("Newsletter table found:",null!==e)}catch(e){console.error("Failed to initialize database:",e)}})().catch(console.error)}},function(e){e.O(0,[36,971,596,744],function(){return e(e.s=1617)}),_N_E=e.O()}]);